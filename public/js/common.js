$(function(){function t(t,e,n){return $.ajax({method:t,url:e,data:n})}function e(e){var n=e.find('input[name="_method"]').val()||"POST",o=e.prop("action");return t(n,o,e.serialize())}function n(e,n){var o=e.find('input[name="_method"]').val()||"POST",i=e.prop("action"),a=e.serialize()+n;return t(o,i,a)}function o(t){t[0].reset()}function i(t){t.find("div.form-group").removeClass("has-error"),t.find("p.help-block").html("")}function a(t,e){var n=$("input[name="+t+"], select[name="+t+"], textarea[name="+t+"]"),o=n.closest("div.form-group"),i=(n.closest("p.help-block"),"");$.isEmptyObject(e)||(o.addClass("has-error"),$.each(e,function(t,e){i+=e+"<br/>"}),n.parent().parent().find("p.help-block").html(i).fadeIn(300))}function r(t,e){i(t),$.each(e,function(t,e){a(t,e)})}function s(t,e){swal({title:e||"Success",text:t,type:"success",timer:1500})}function c(t,e){swal({title:e||"Success",text:t,type:"info",timer:1500})}function d(t,e){swal({title:e||"Error",text:t,type:"error"})}$("form[data-form-remote]").on("submit",function(t){t.preventDefault();var n=$(this),i=e(n),a=n.find('input[type="submit"]');a.prop("disabled",!0),i.done(function(t){void 0!=t.message&&s(t.message),o(n),setTimeout(function(){void 0!=t.redirectTo?window.location=t.redirectTo:location.reload()},1e3)}).fail(function(t){null==t.responseJSON.error?r(n,t.responseJSON):d(t.responseJSON.error)}).always(function(){a.prop("disabled",!1)})}),$("input[data-confirm], button[data-confirm]").on("click",function(t){t.preventDefault();var e=$(this),n=e.closest("form"),o=e.data("confirm")||"Are you sure?",i=e.data("confirm-yes")||"Yes, pls!";swal({title:"Are you sure?",text:o,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:i,cancelButtonText:"No, cancel pls!",closeOnConfirm:!1},function(t){t&&n.submit()})});var l=function(){$(".select2-multi").select2()},u=function(t,e){if("undefined"!=typeof tmpl){var n=e.data("index")>0?e.data("index"):e.children().length+1;e.data("index",n+1);var o=tmpl(t,{index:n}),i=$(o).appendTo(e).hide().slideDown("fast");l(i,n),i.on("click",".btn-delete",function(t){i.slideUp("fast",function(){i.remove()})})}};$("[data-duplicate]").on("click",function(t){var e=$(this),n=e.data("duplicate"),o=$(e.data("target"));u(n,o)}),$("[data-duplicate]").each(function(){var t=$(this),e=t.data("duplicate"),n=$(t.data("target"));u(e,n)}),$("input.material-datetime").bootstrapMaterialDatePicker({format:"YYYY-MM-DD HH:mm",minDate:new Date}),$(".select2-multi").select2(),$(".notification:not(.seen)").on("click",function(e){var n=$(this),o=n.data("id"),i=n.data("recipient");t("PATCH","/notification/markseen",{id:o,to_userid:i}).done(function(){n.addClass("seen")})}),$("ul.notifications-list .notification:not(.seen)").on("click",function(){var e=$(this),n=e.find("a").prop("href"),o=e.data("recipient");t("PATCH","/notification/markseen",{link:n,to_userid:o}).done(function(){e.addClass("seen")})}),$("#form-task-confirm button[data-task-confirm]").on("click",function(){var e=$(this).data("task-confirm"),n=$("#form-task-confirm"),o=n.find('input[name="_method"]').val()||"POST",i=n.prop("action"),a=n.serialize()+"&confirm="+e;t(o,i,a).done(function(t){c(t.message,""),setTimeout(function(){void 0!=t.redirectTo?window.location=t.redirectTo:location.reload()},1500)})}),$("#view-task-image-modal").on("show.bs.modal",function(t){var e=$(t.relatedTarget).find("img").prop("src");$(this).find(".modal-body img").prop("src",e)}).on("hidden.bs.modal",function(){$(this).find(".modal-body img").prop("src","")}),$(".btn-update-task-status").on("click",function(){var t=$(this),e=t.data("status"),o=t.data("userid"),i=t.closest("form"),a=i.find(".loader"),r="&status="+e+"&from_userid="+o;a.show(),n(i,r).done(function(n){return i.parent().find(".current-status-content").text(n.status),$(".tooltip").hide(),"done"===e?void t.parent().remove():void t.remove()}).always(function(){a.hide()})}),$(".form-task-leave-note").on("submit",function(t){t.preventDefault();var n=$(this),i=e(n),a=n.find(".loader");a.show(),n.find(".help-block").text(""),n.find(".form-group").removeClass("has-error"),i.done(function(t){var e=$("#noteTpl").html(),i=Mustache.to_html(e,t.note);$("#list-tasknote").prepend(i),$("#no-notes-item").remove(),$("#list-tasknote li").length>=6&&$("#list-tasknote li:last").remove(),o(n)}).fail(function(t){var e=t.responseJSON.note[0];n.find(".help-block").text(e),n.find(".form-group").addClass("has-error")}).always(function(){a.hide()})}),$("[data-tooltip-validation]").tooltip({trigger:"manual"}).tooltip("show"),$("input.mobile_no").inputmask("mask",{mask:"(+63) 999-9999999"}),$("table.datatable").DataTable()});